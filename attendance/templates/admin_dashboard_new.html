{% extends 'base.html' %}
{% load static %}

{% block title %}Admin Dashboard - Face Recognition Attendance{% endblock %}

{% block extra_head %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
<style type="text/css">
    .card-hover:hover {
        transform: translateY(-5px);
        transition: transform 0.3s ease;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }
    .stat-card {
        border-left: 4px solid #4e73df;
    }
    .stat-card i {
        font-size: 2rem;
        opacity: 0.7;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Page Heading -->
    <div class="d-sm-flex align-items-center justify-content-between mb-4">
        <h1 class="h3 mb-0 text-gray-800">Admin Dashboard</h1>
        <div class="d-none d-sm-inline-block">
            <button class="btn btn-sm btn-primary shadow-sm" onclick="exportData()">
                <i class="fas fa-download fa-sm text-white-50"></i> Generate Report
            </button>
        </div>
    </div>

    <!-- Stats Cards -->
    <div class="row">
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-primary shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                                Total Employees</div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">{{ total_employees }}</div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-users fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-success shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                                Present Today</div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">{{ present_today }}/{{ active_employees }}</div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-calendar-check fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-info shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                                Face Encodings</div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">{{ with_face_encoding }} ({{ face_encoding_percentage }}%)</div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-smile fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-warning shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                                Recognition Accuracy</div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">{{ avg_confidence }}%</div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-percent fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Content Row -->
    <div class="row">
        <!-- System Management -->
        <div class="col-lg-6 mb-4">
            <div class="card shadow mb-4">
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold text-primary">System Management</h6>
                    <div class="dropdown no-arrow">
                        <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink"
                            data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end shadow" aria-labelledby="dropdownMenuLink">
                            <li><a class="dropdown-item" href="#" onclick="refreshSystem()"><i class="fas fa-sync-alt fa-fw me-2"></i>Refresh System</a></li>
                            <li><a class="dropdown-item" href="#" onclick="clearCache()"><i class="fas fa-broom fa-fw me-2"></i>Clear Cache</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item text-danger" href="#" data-bs-toggle="modal" data-bs-target="#maintenanceModal">
                                <i class="fas fa-tools fa-fw me-2"></i>Maintenance Mode
                            </a></li>
                        </ul>
                    </div>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <a href="{% url 'employee_list' %}" class="btn btn-outline-primary w-100 mb-2">
                                <i class="fas fa-users me-2"></i>Manage Employees
                            </a>
                        </div>
                        <div class="col-md-6 mb-3">
                            <a href="{% url 'attendance_history' %}" class="btn btn-outline-info w-100 mb-2">
                                <i class="fas fa-history me-2"></i>View Attendance
                            </a>
                        </div>
                        <div class="col-md-6 mb-3">
                            <a href="/admin/" class="btn btn-outline-secondary w-100 mb-2">
                                <i class="fas fa-database me-2"></i>Django Admin
                            </a>
                        </div>
                        <div class="col-md-6 mb-3">
                            <button class="btn btn-outline-success w-100 mb-2" onclick="exportData()">
                                <i class="fas fa-file-export me-2"></i>Export Data
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Activity -->
        <div class="col-lg-6 mb-4">
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Recent Activity</h6>
                </div>
                <div class="card-body">
                    <div class="list-group list-group-flush">
                        {% for record in recent_records|slice:":5" %}
                        <div class="list-group-item list-group-item-action">
                            <div class="d-flex w-100 justify-content-between">
                                <h6 class="mb-1">{{ record.employee.get_full_name|default:record.employee.employee_id }}</h6>
                                <small class="text-muted">{{ record.timestamp|timesince }} ago</small>
                            </div>
                            <p class="mb-1">
                                <span class="badge bg-{{ record.attendance_type|yesno:'success,info' }}">
                                    {{ record.get_attendance_type_display }}
                                </span>
                                {% if record.confidence_score %}
                                <span class="badge bg-{{ record.confidence_score|floatformat:0|add:'0'|divisibleby:10|yesno:'success,info' }}">
                                    {{ record.confidence_score|floatformat:1 }}% confidence
                                </span>
                                {% endif %}
                            </p>
                        </div>
                        {% empty %}
                        <p class="text-muted text-center py-3">No recent activity found</p>
                        {% endfor %}
                    </div>
                    <a href="{% url 'attendance_history' %}" class="btn btn-link btn-sm mt-3">View All Activity</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Department Overview -->
    <div class="row">
        <div class="col-12">
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Department Overview</h6>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-bordered" id="departmentTable" width="100%" cellspacing="0">
                            <thead>
                                <tr>
                                    <th>Department</th>
                                    <th>Total Employees</th>
                                    <th>Present Today</th>
                                    <th>Attendance Rate</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for dept in departments %}
                                <tr>
                                    <td>{{ dept.name|default:"Unassigned" }}</td>
                                    <td>{{ dept.employee_count }}</td>
                                    <td>{{ dept.present_today|default:0 }}</td>
                                    <td>
                                        <div class="progress">
                                            {% with rate=dept.present_today|default:0|div:dept.employee_count|mul:100|floatformat:0 %}
                                            {% with style_width=rate|stringformat:"s"|add:"%" %}
                                            <div class="progress-bar bg-success" role="progressbar" 
                                                {% if style_width %}style="width: {{ style_width }};"{% endif %}
                                                aria-valuenow="{{ rate }}" 
                                                aria-valuemin="0" 
                                                aria-valuemax="100">
                                            {% endwith %}
                                                {{ rate }}%
                                            </div>
                                            {% endwith %}
                                        </div>
                                    </td>
                                    <td>
                                        <a href="#" class="btn btn-sm btn-outline-primary">View</a>
                                    </td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="5" class="text-center">No department data available</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<!-- Custom Scripts for Admin Dashboard -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>

<script>
// System Management Functions
function refreshSystem() {
    showToast('Refreshing system data...', 'info');
    // Reload the page after a short delay
    setTimeout(() => {
        window.location.reload();
    }, 1000);
}

function clearCache() {
    showToast('Clearing cache...', 'info');
    
    fetch("{% url 'api_clear_cache' %}", {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken')
        },
        credentials: 'same-origin'
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        return response.json();
    })
    .then(data => {
        if (data.success) {
            showToast('Cache cleared successfully!', 'success');
        } else {
            showToast('Failed to clear cache: ' + (data.error || 'Unknown error'), 'error');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        showToast('Error clearing cache: ' + error.message, 'error');
    });
}

function exportData() {
    showToast('Preparing data export...', 'info');
    
    // Create an invisible iframe to handle the file download
    const iframe = document.createElement('iframe');
    iframe.style.display = 'none';
    document.body.appendChild(iframe);
    
    // Set the iframe's source to the export URL with a timestamp to prevent caching
    const timestamp = new Date().getTime();
    const exportUrl = '{% url "export_data" %}';
    if (exportUrl) {
        iframe.src = exportUrl + '?t=' + timestamp;
        
        // Remove the iframe after a delay
        setTimeout(() => {
            if (iframe.parentNode) {
                document.body.removeChild(iframe);
            }
            showToast('Export started successfully!', 'success');
        }, 3000);
    } else {
        showToast('Error: Could not generate export URL', 'error');
    }
}

// Helper function to get CSRF token
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

// Toast notification function
function showToast(message, type) {
    // Set default type if not provided
    type = type || 'info';
    
    let toastContainer = document.getElementById('toastContainer');
    if (!toastContainer) {
        // Create toast container if it doesn't exist
        toastContainer = document.createElement('div');
        toastContainer.id = 'toastContainer';
        toastContainer.style.position = 'fixed';
        toastContainer.style.top = '20px';
        toastContainer.style.right = '20px';
        toastContainer.style.zIndex = '9999';
        toastContainer.style.width = '300px';
        document.body.appendChild(toastContainer);
    }
    
    const toast = document.createElement('div');
    toast.className = 'toast align-items-center text-white border-0 mb-2';
    
    // Add appropriate background class based on type
    const bgClass = 'bg-' + (['success', 'danger', 'warning', 'info'].includes(type) ? type : 'info');
    toast.classList.add(bgClass);
    
    toast.setAttribute('role', 'alert');
    toast.setAttribute('aria-live', 'assertive');
    toast.setAttribute('aria-atomic', 'true');
    
    const toastBody = document.createElement('div');
    toastBody.className = 'd-flex';
    
    const toastContent = document.createElement('div');
    toastContent.className = 'toast-body';
    toastContent.textContent = message;
    
    const closeButton = document.createElement('button');
    closeButton.type = 'button';
    closeButton.className = 'btn-close btn-close-white me-2 m-auto';
    closeButton.setAttribute('data-bs-dismiss', 'toast');
    closeButton.setAttribute('aria-label', 'Close');
    
    toastBody.appendChild(toastContent);
    toastBody.appendChild(closeButton);
    toast.appendChild(toastBody);
    
    toastContainer.appendChild(toast);
    
    // Initialize and show the toast
    const bsToast = new bootstrap.Toast(toast, { 
        autohide: true, 
        delay: 5000 
    });
    bsToast.show();
    
    // Remove toast after it's hidden
    toast.addEventListener('hidden.bs.toast', function () {
        if (toast && toast.parentNode) {
            toast.parentNode.removeChild(toast);
        }
    });
}

// Initialize DataTable for department overview
document.addEventListener('DOMContentLoaded', function() {
    'use strict';
    
    // Initialize tooltips
    try {
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        tooltipTriggerList.forEach(function(tooltipTriggerEl) {
            try {
                new bootstrap.Tooltip(tooltipTriggerEl);
            } catch (e) {
                console.error('Error initializing tooltip:', e);
            }
        });
    } catch (e) {
        console.error('Error initializing tooltips:', e);
    }
    try {
        if (typeof $ !== 'undefined' && typeof $.fn.DataTable === 'function') {
            $('.data-table').DataTable({
                responsive: true,
                order: [[0, 'asc']],
                pageLength: 10,
                lengthMenu: [[5, 10, 25, 50, -1], [5, 10, 25, 50, 'All']],
                language: {
                    search: '_INPUT_',
                    searchPlaceholder: 'Search...',
                }
            });
        }
    } catch (e) {
        console.error('Error initializing DataTable:', e);
    }
    
    // Initialize WebSocket connection if available
    if (window.AttendanceWebSockets) {
        try {
            window.AttendanceWebSockets.initDashboard();
        } catch (e) {
            console.error('Error initializing WebSockets:', e);
        }
    }
    
    // Initialize tooltips
    try {
        var tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]');
        Array.prototype.forEach.call(tooltipTriggerList, function(tooltipTriggerEl) {
            try {
                new bootstrap.Tooltip(tooltipTriggerEl);
            } catch (e) {
                console.error('Error initializing tooltip:', e);
            }
        });
    } catch (e) {
        console.error('Error initializing tooltips:', e);
    }
});

// Initialize maintenance mode toggle
document.addEventListener('DOMContentLoaded', function() {
    'use strict';
    
    const maintenanceToggle = document.getElementById('maintenanceToggle');
    const confirmBtn = document.getElementById('confirmMaintenance');
    
    if (maintenanceToggle && confirmBtn) {
        // Check current maintenance status
        const statusUrl = '{% url \"api_maintenance_status\" %}';
        if (!statusUrl) {
            console.error('Maintenance status URL could not be generated');
            return;
        }
        
        fetch(statusUrl, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCookie('csrftoken')
            },
            credentials: 'same-origin'
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
                return response.json();
            })
            .then(data => {
                maintenanceToggle.checked = data.maintenance_mode || false;
                // Update the switch UI to match the initial state
                const switchLabel = maintenanceToggle.nextElementSibling;
                if (switchLabel && switchLabel.classList.contains('form-check-label')) {
                    switchLabel.textContent = data.maintenance_mode ? 'ON' : 'OFF';
                }
            })
            .catch(error => {
                console.error('Error checking maintenance status:', error);
                showToast('Error checking maintenance status', 'error');
            });
        
        // Handle toggle change
        maintenanceToggle.addEventListener('change', function() {
            const modal = new bootstrap.Modal(document.getElementById('maintenanceModal'));
            const modalMessage = document.getElementById('maintenanceModalMessage');
            
            if (maintenanceToggle.checked) {
                modalMessage.textContent = 'Enabling maintenance mode will restrict access to admin users only. Are you sure you want to proceed?';
            } else {
                modalMessage.textContent = 'Disabling maintenance mode will allow all users to access the system. Continue?';
            }
            
            modal.show();
        });
        
        // Handle confirm button click
        confirmBtn.addEventListener('click', function() {
            const enable = maintenanceToggle.checked;
            const message = enable ? 
                'Enabling maintenance mode. Only admin users will be able to access the system.' : 
                'Disabling maintenance mode. All users will be able to access the system.';
                
            showToast(message, 'info');
            
            const toggleUrl = '{% url \"api_toggle_maintenance\" %}';
            if (!toggleUrl) {
                console.error('Toggle maintenance URL could not be generated');
                return;
            }
            
            fetch(toggleUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken')
                },
                credentials: 'same-origin',
                body: JSON.stringify({
                    maintenance_mode: enable
                })
            })
            .then(response => {
                if (!response.ok) {
                    return response.json().then(errData => {
                        // If we can parse the error, use its message
                        if (errData && errData.error) {
                            throw new Error(errData.error);
                        }
                        throw new Error(`HTTP error! status: ${response.status}`);
                    });
                }
                return response.json();
            })
            .then(data => {
                if (data.success) {
                    // Update the switch label
                    const switchLabel = maintenanceToggle.nextElementSibling;
                    if (switchLabel && switchLabel.classList.contains('form-check-label')) {
                        switchLabel.textContent = enable ? 'ON' : 'OFF';
                    }
                    
                    showToast(
                        enable ? 'Maintenance mode enabled successfully!' : 'Maintenance mode disabled successfully!', 
                        'success'
                    );
                } else {
                    throw new Error(data.error || 'Failed to update maintenance mode');
                }
            })
            .catch(error => {
                maintenanceToggle.checked = !enable; // Revert toggle on error
                console.error('Error:', error);
                showToast('Error updating maintenance mode: ' + error.message, 'error');
            })
            .finally(() => {
                const modal = bootstrap.Modal.getInstance(document.getElementById('maintenanceModal'));
                if (modal) modal.hide();
            });
        });
    }
});

</script>

<!-- Toast Container -->
<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1100;">
    <div id="toastContainer" class="toast-container">
        <!-- Toasts will be added here dynamically -->
    </div>
</div>

<!-- Maintenance Mode Modal -->
<div class="modal fade" id="maintenanceModal" tabindex="-1" aria-labelledby="maintenanceModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-warning">
                <h5 class="modal-title" id="maintenanceModalLabel">
                    <i class="fas fa-tools me-2"></i>Maintenance Mode
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p id="maintenanceModalMessage"></p>
                <div class="form-check form-switch mb-3">
                    <input class="form-check-input" type="checkbox" id="maintenanceToggle">
                    <label class="form-check-label" for="maintenanceToggle">Enable Maintenance Mode</label>
                </div>
                <div class="alert alert-info mb-0">
                    <i class="fas fa-info-circle me-2"></i>
                    Users will see a maintenance page until you disable this mode.
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-warning" id="confirmMaintenance">
                    <i class="fas fa-cog fa-spin d-none me-2"></i>
                    <span>Confirm</span>
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Maintenance Mode Script -->
<script>
(function() {
    'use strict';
    
    document.addEventListener('DOMContentLoaded', function() {
        var maintenanceToggle = document.getElementById('maintenanceToggle');
        var confirmBtn = document.getElementById('confirmMaintenance');
        
        if (!maintenanceToggle || !confirmBtn) {
            return;
        }
        
        // Load current maintenance mode status
        var statusUrl = '{% url "api_maintenance_status" %}';
        if (!statusUrl) {
            console.error('Maintenance status URL could not be generated');
            return;
        }
        
        // Function to update UI based on maintenance status
        function updateMaintenanceStatus() {
            fetch(statusUrl, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken')
                },
                credentials: 'same-origin'
            })
            .then(function(response) {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(function(data) {
                maintenanceToggle.checked = !!data.maintenance_mode;
                var switchLabel = maintenanceToggle.nextElementSibling;
                if (switchLabel && switchLabel.classList.contains('form-check-label')) {
                    switchLabel.textContent = data.maintenance_mode ? 'ON' : 'OFF';
                }
            })
            .catch(function(error) {
                console.error('Error checking maintenance status:', error);
                showToast('Error checking maintenance status', 'error');
            });
        }
        
        // Initial status load
        updateMaintenanceStatus();
        
        // Handle confirm button click
        confirmBtn.addEventListener('click', function() {
            var enable = maintenanceToggle.checked;
            var message = enable ? 
                'Enabling maintenance mode. Only admin users will be able to access the system.' : 
                'Disabling maintenance mode. All users will be able to access the system.';
                
            showToast(message, 'info');
            
            var toggleUrl = '{% url "api_toggle_maintenance" %}';
            if (!toggleUrl) {
                console.error('Toggle maintenance URL could not be generated');
                return;
            }
            
            // Disable button during request
            var confirmBtn = this;
            var originalText = confirmBtn.innerHTML;
            confirmBtn.disabled = true;
            confirmBtn.innerHTML = '<i class="fas fa-cog fa-spin me-2"></i>Processing...';
            
            // Send request to toggle maintenance mode
            fetch(toggleUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken')
                },
                credentials: 'same-origin',
                body: JSON.stringify({
                    maintenance_mode: enable
                })
            })
            .then(function(response) {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(function(data) {
                showToast(data.message || 'Maintenance mode updated successfully', 'success');
                // Update UI to reflect new status
                var switchLabel = maintenanceToggle.nextElementSibling;
                if (switchLabel && switchLabel.classList.contains('form-check-label')) {
                    switchLabel.textContent = enable ? 'ON' : 'OFF';
                }
            })
            .catch(function(error) {
                console.error('Error toggling maintenance mode:', error);
                showToast('Error updating maintenance mode: ' + (error.message || 'Unknown error'), 'error');
                // Revert toggle on error
                maintenanceToggle.checked = !enable;
            })
            .finally(function() {
                // Re-enable button
                confirmBtn.disabled = false;
                confirmBtn.innerHTML = originalText;
                // Close the modal
                var modal = bootstrap.Modal.getInstance(document.getElementById('maintenanceModal'));
                if (modal) modal.hide();
            });
        });
    });
})();
</script>
{% endblock %}
